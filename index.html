<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Banditi - Team Stats</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body {
    background-color: #1f1f2e;
    color: #f0f0f0;
    font-family: 'Segoe UI', sans-serif;
    padding: 20px;
  }
  .header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  .header img {
    height: 60px;
    user-select: none;
  }
  .header h1 {
    color: #00ffc8;
    margin: 0;
    font-size: 2.2em;
  }
  .nav {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 25px;
  }
  .nav button {
    background-color: #00ffc8;
    color: #1f1f2e;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  .nav button:hover {
    background-color: #00d1a8;
  }
  .section {
    display: none;
  }
  .section.active {
    display: block;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background-color: #2a2a3d;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    margin-bottom: 10px;
  }
  th, td {
    padding: 8px 12px;
    text-align: center;
    border-bottom: 1px solid #3c3c50;
  }
  th {
    background-color: #34344a;
    color: #00ffc8;
    font-weight: bold;
  }
  tr:nth-child(even) {
    background-color: #262636;
  }
  tr:hover {
    background-color: #3a3a56;
  }
  td[contenteditable="true"] {
    cursor: text;
    background-color: #3a3a56;
  }
  .tables-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .table-wrapper {
    flex: 1;
    min-width: 300px;
  }
  .chart-wrapper {
    flex: 1;
    min-width: 300px;
  }
  .update-info {
    font-size: 0.8em;
    color: #00ffc8;
    text-align: right;
    margin-bottom: 10px;
  }
  .limits {
    background-color: #2a2a3d;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .limits h2 {
    color: #00ffc8;
    margin-top: 0;
  }
  .limits ul {
    columns: 2;
    padding-left: 20px;
  }
  .limits li {
    margin-bottom: 5px;
  }
  #guildInfo {
    width: 100%;
    min-height: 500px;
    background-color: #2a2a3d;
    color: #f0f0f0;
    border: 1px solid #3c3c50;
    border-radius: 10px;
    padding: 15px;
    font-family: 'Segoe UI', sans-serif;
    resize: vertical;
  }
  .edit-icon {
    cursor: pointer;
    color: #00ffc8;
    margin-left: 10px;
    font-size: 0.8em;
  }
  .add-player, .update-btn, .save-pdf-btn {
    background-color: #00ffc8;
    color: #1f1f2e;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .add-player:hover, .update-btn:hover, .save-pdf-btn:hover {
    background-color: #00d1a8;
  }
  .positive {
    color: #00ff00;
    font-weight: bold;
  }
  .negative {
    color: #ff0000;
    font-weight: bold;
  }
  .workshop-status {
    font-weight: bold;
  }
  select.role-select {
    background-color: #262636;
    border: none;
    color: #00ffc8;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    padding: 2px 5px;
  }
  canvas {
    width: 100% !important;
    height: 400px !important;
  }
  #playersTable {
  table-layout: auto !important;
  width: 100% !important;
  }
  #playersTable td, #playersTable th {
  text-align: center !important;
  vertical-align: middle;
  }
  #playersTable td.role-icon, #playersTable td.role-select {
  text-align: center !important;
  width: 60px;
  font-size: 1.3em;
  }
  #playersTable td.info-icon {
  cursor: pointer;
  color: #00ffc8;
  font-weight: bold;
  font-size: 1.2em;
  user-select: none;
  }

</style>
</head>
<body>

<div class="header">
  <img src="logo.png" alt="Logo" />
  <h1>Banditi - Team Stats</h1>
</div>

<div class="nav">
  <button onclick="showSection('guild')">üè∞ Guild Info</button>
  <button onclick="showSection('players')">üë• Players Info</button>
  <button onclick="showSection('xp')">üìà XP Tournament</button>
  <button onclick="showSection('herocon')">‚öîÔ∏è HeroCon Tournament</button>
</div>

<div id="guild" class="section">
  <h2>Guild Info <span class="edit-icon" onclick="requestEditAccess()">‚úèÔ∏è</span></h2>
  <textarea id="guildInfo" readonly>
Casino: 

Casino with high quality rewards
2025-07-02 00:00:00 - 2025-07-05 23:59:59

... (zbytek textu z tv√©ho origin√°lu) ...
  </textarea>
</div>

<div id="players" class="section">
  <h2>Players Info <span class="edit-icon" onclick="requestEditAccess()">‚úèÔ∏è</span></h2>
  
  <div class="limits">
    <h2>Limity d√≠lny podle levelu:</h2>
    <ul>
        <li>Lvl 500+ ‚Üí D√≠lna 20</li>
        <li>Lvl 450+ ‚Üí D√≠lna 19</li>
        <li>Lvl 400+ ‚Üí D√≠lna 18</li>
        <li>Lvl 350+ ‚Üí D√≠lna 17</li>
        <li>Lvl 325+ ‚Üí D√≠lna 16</li>
        <li>Lvl 300+ ‚Üí D√≠lna 15</li>
        <li>Lvl 275+ ‚Üí D√≠lna 14</li>
        <li>Lvl 250+ ‚Üí D√≠lna 13</li>
        <li>Lvl 230+ ‚Üí D√≠lna 12</li>
        <li>Lvl 210+ ‚Üí D√≠lna 11</li>
        <li>Lvl 190+ ‚Üí D√≠lna 10</li>
        <li>Lvl 170+ ‚Üí D√≠lna 9</li>
        <li>Lvl 150+ ‚Üí D√≠lna 8</li>
        <li>Lvl 100+ ‚Üí D√≠lna 7</li>
    </ul>
  </div>
  
  <button class="add-player" onclick="addPlayerRow('playersBody')">‚ûï Add Player</button>
  
  <table id="playersTable">
    <thead>
      <tr>
        <th>Role</th>
        <th>Nickname</th>
        <th>Level</th>
        <th>Workshop Level</th>
        <th>Workshop Status</th>
        <th>Missed Fights</th>
        <th>Info</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="playersBody"></tbody>
  </table>
  <button class="save-pdf-btn" onclick="saveTableToPDF('playersTable', 'Players Info')">üíæ Ulo≈æit Players do PDF</button>
</div>

<div id="xp" class="section">
  <h2>XP Tournament <span class="edit-icon" onclick="requestEditAccess()">‚úèÔ∏è</span></h2>
  
  <button class="update-btn" onclick="updateTournament('xp')">üîÑ Aktualizovat</button>
  <button class="add-player" onclick="addPlayerRow('xpBody')">‚ûï Add Player</button>
  
  <div class="tables-container">
    <div class="table-wrapper">
      <div class="update-info">Last updated: <span id="xpUpdateDate"></span></div>
      <table id="xpTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>XP Gained</th>
          </tr>
        </thead>
        <tbody id="xpBody">
          <tr><td contenteditable="true">1</td><td contenteditable="true">Alfa</td><td contenteditable="true">1230</td></tr>
          <tr><td contenteditable="true">2</td><td contenteditable="true">Sazaro</td><td contenteditable="true">980</td></tr>
          <tr><td contenteditable="true">3</td><td contenteditable="true">Bandita</td><td contenteditable="true">840</td></tr>
        </tbody>
      </table>
      <button class="save-pdf-btn" onclick="saveTableToPDF('xpTable', 'XP Tournament')">üíæ Ulo≈æit XP Tournament do PDF</button>
    </div>
    <div class="chart-wrapper">
      <canvas id="xpChart"></canvas>
    </div>
  </div>
</div>

<div id="herocon" class="section">
  <h2>HeroCon Tournament <span class="edit-icon" onclick="requestEditAccess()">‚úèÔ∏è</span></h2>
  
  <button class="update-btn" onclick="updateTournament('herocon')">üîÑ Aktualizovat</button>
  <button class="add-player" onclick="addPlayerRow('heroconBody')">‚ûï Add Player</button>
  
  <div class="tables-container">
    <div class="table-wrapper">
      <div class="update-info">Last updated: <span id="heroconUpdateDate"></span></div>
      <table id="heroconTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>HeroCon Gained</th>
          </tr>
        </thead>
        <tbody id="heroconBody">
          <tr><td contenteditable="true">1</td><td contenteditable="true">Alfa</td><td contenteditable="true">540</td></tr>
          <tr><td contenteditable="true">2</td><td contenteditable="true">Sazaro</td><td contenteditable="true">480</td></tr>
          <tr><td contenteditable="true">3</td><td contenteditable="true">Bandita</td><td contenteditable="true">300</td></tr>
        </tbody>
      </table>
      <button class="save-pdf-btn" onclick="saveTableToPDF('heroconTable', 'HeroCon Tournament')">üíæ Ulo≈æit HeroCon Tournament do PDF</button>
    </div>
    <div class="chart-wrapper">
      <canvas id="heroconChart"></canvas>
    </div>
  </div>
</div>

<script>
  // --- Global ---
  let editMode = false;
  const PASSWORD = "TopBanditi1";

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }
  // default view
  showSection('guild');

  // --- Edit Access ---
  function requestEditAccess() {
    if (editMode) {
      alert("√öpravy ji≈æ povoleny.");
      return;
    }
    let pwd = prompt("Zadej heslo pro √∫pravy:");
    if (pwd === PASSWORD) {
      editMode = true;
      enableEditing();
      alert("√öpravy povoleny. Nyn√≠ m≈Ø≈æete mƒõnit data.");
    } else {
      alert("≈†patn√© heslo.");
    }
  }

  function enableEditing() {
    document.querySelectorAll('select.role-select').forEach(sel => sel.disabled = false);
    document.querySelectorAll('button.delete-btn').forEach(btn => btn.disabled = false);


    
    // Guild info textarea
    document.getElementById('guildInfo').readOnly = false;

    // Players Table edit
    const playersBody = document.getElementById('playersBody');
    playersBody.querySelectorAll('tr').forEach(row => {
      row.querySelectorAll('td').forEach((td, i) => {
        // Except Role icon cell (index 0)
        if(i !== 0 && i !== 7) td.contentEditable = "true";
      });
      // Enable select and delete btn
      const select = row.querySelector('select.role-select');
      if(select) select.disabled = false;
      const delBtn = row.querySelector('button.delete-btn');
      if(delBtn) delBtn.disabled = false;
    });

    // XP and HeroCon tables
    ['xpBody', 'heroconBody'].forEach(id => {
      const tbody = document.getElementById(id);
      tbody.querySelectorAll('tr').forEach(tr => {
        tr.querySelectorAll('td').forEach(td => td.contentEditable = "true");
      });
    });

    // Enable selects in players table for roles
    document.querySelectorAll('select.role-select').forEach(sel => sel.disabled = false);
    
    // Enable delete buttons
    document.querySelectorAll('button.delete-btn').forEach(btn => btn.disabled = false);
  }

  // --- Players Table handling ---
  const initialPlayers = [
    {role:'leader', name:'Alfa', level:'198', workshop:'28', missed:'0', info:'Velitel t√Ωmu'},
    {role:'officer', name:'Sazaro', level:'150', workshop:'20', missed:'1', info:'D≈Østojn√≠k'},
    {role:'member', name:'Bandita', level:'180', workshop:'25', missed:'2', info:'ƒålen t√Ωmu'},
  ];

  function roleIcon(role) {
    switch(role) {
      case 'leader': return 'üëë';
      case 'officer': return 'üõ°Ô∏è';
      case 'member': return 'üë§';
      default: return '';
    }
  }

  function renderPlayers() {
    const tbody = document.getElementById('playersBody');
    tbody.innerHTML = '';
    initialPlayers.forEach(p => {
    const tr = document.createElement('tr');

    // Role select - p≈ôed jm√©nem
    let tdRoleSelect = document.createElement('td');
    let select = document.createElement('select');
    select.className = 'role-select';
    select.disabled = !editMode;
    ['leader', 'officer', 'member'].forEach(r => {
      let opt = document.createElement('option');
      opt.value = r;
      opt.text = r.charAt(0).toUpperCase() + r.slice(1) + ' ' + roleIcon(r);
      if (r === p.role) opt.selected = true;
      select.appendChild(opt);
    });
    select.onchange = function () {
      // p≈ôi zmƒõnƒõ role aktualizuj ikonku role
      tdRoleIcon.textContent = roleIcon(this.value);
    };
    tdRoleSelect.appendChild(select);
    tr.appendChild(tdRoleSelect);

    // Role ikona (jen zobrazen√≠)
    let tdRoleIcon = document.createElement('td');
    tdRoleIcon.className = 'role-icon';
    tdRoleIcon.textContent = roleIcon(p.role);
    tr.appendChild(tdRoleIcon);

    // Jm√©no hr√°ƒçe + ikona info
    let tdName = document.createElement('td');
    tdName.textContent = p.name;
    tdName.contentEditable = false;

    // Ikona info vedle jm√©na
    let infoIcon = document.createElement('span');
    infoIcon.className = 'info-icon';
    infoIcon.textContent = '‚ÑπÔ∏è';
    infoIcon.title = 'Zobrazit / upravit info hr√°ƒçe';
    infoIcon.onclick = () => openInfoModal(tdInfo, tdName);
    tdName.appendChild(document.createTextNode(' ')); // mezera mezi jm√©nem a ikonou
    tdName.appendChild(infoIcon);

    tr.appendChild(tdName);

    // Level
    let tdLevel = document.createElement('td');
    tdLevel.textContent = p.level;
    tdLevel.contentEditable = false;
    tr.appendChild(tdLevel);

    // Workshop Level
    let tdWorkshop = document.createElement('td');
    tdWorkshop.textContent = p.workshop;
    tdWorkshop.contentEditable = false;
    tr.appendChild(tdWorkshop);

    // Workshop Status
    let tdWorkshopStatus = document.createElement('td');
    tdWorkshopStatus.className = 'workshop-status';
    tdWorkshopStatus.textContent = calculateWorkshopStatus(p.level, p.workshop);
    tr.appendChild(tdWorkshopStatus);

    // Missed fights
    let tdMissed = document.createElement('td');
    tdMissed.textContent = p.missed;
    tdMissed.contentEditable = false;
    tr.appendChild(tdMissed);

    // Info (skryt√©, pro mod√°l)
    let tdInfo = document.createElement('td');
    tdInfo.textContent = p.info;
    tdInfo.style.display = 'none';
    tr.appendChild(tdInfo);

    // Delete button
    let tdDelete = document.createElement('td');
    let btnDelete = document.createElement('button');
    btnDelete.textContent = 'Smazat';
    btnDelete.disabled = !editMode;
    btnDelete.className = 'delete-btn';
    btnDelete.onclick = () => {
      if (!editMode) return alert('Nejd≈ô√≠ve povol √∫pravy');
      if (confirm(`Opravdu smazat hr√°ƒçe ${p.name}?`)) {
        tr.remove();
      }
    };
    tdDelete.appendChild(btnDelete);
    tr.appendChild(tdDelete);

    tbody.appendChild(tr);
  });


      // Role select pro √∫pravu role
      let tdRoleSelect = document.createElement('td');
      let select = document.createElement('select');
      select.className = 'role-select';
      select.disabled = true;
      ['leader', 'officer', 'member'].forEach(r => {
        let opt = document.createElement('option');
        opt.value = r;
        opt.text = r.charAt(0).toUpperCase() + r.slice(1) + ' ' + roleIcon(r);
        if(r === p.role) opt.selected = true;
        select.appendChild(opt);
      });
      select.onchange = function() {
        tdRoleIcon.textContent = roleIcon(this.value);
      };
      tdRoleSelect.appendChild(select);
      tr.insertBefore(tdRoleSelect, tdName);

      tbody.appendChild(tr);
    });
  }

  function calculateWorkshopStatus(level, workshopLvl) {
    // Limity dle levelu (zjednodu≈°eno)
    const limits = [
      { lvl: 500, limit: 20 },
      { lvl: 450, limit: 19 },
      { lvl: 400, limit: 18 },
      { lvl: 350, limit: 17 },
      { lvl: 325, limit: 16 },
      { lvl: 300, limit: 15 },
      { lvl: 275, limit: 14 },
      { lvl: 250, limit: 13 },
      { lvl: 230, limit: 12 },
      { lvl: 210, limit: 11 },
      { lvl: 190, limit: 10 },
      { lvl: 170, limit: 9 },
      { lvl: 150, limit: 8 },
      { lvl: 100, limit: 7 },
    ];
    level = Number(level);
    workshopLvl = Number(workshopLvl);
    let allowed = 7; // default
    for(let i=0; i<limits.length; i++) {
      if(level >= limits[i].lvl) {
        allowed = limits[i].limit;
        break;
      }
    }
    if(workshopLvl === allowed) return 'OK';
    if(workshopLvl > allowed) return `+${workshopLvl - allowed}`;
    return `-${allowed - workshopLvl}`;
  }

  function addPlayerRow(tbodyId) {
    if(!editMode) return alert('Nejd≈ô√≠ve povol √∫pravy.');
    const tbody = document.getElementById(tbodyId);
    const tr = document.createElement('tr');
    
  if(tbodyId === 'playersBody') {
    // Role select
    let tdRoleSelect = document.createElement('td');
    let select = document.createElement('select');
    select.className = 'role-select';
    select.disabled = !editMode;
    ['leader', 'officer', 'member'].forEach(r => {
      let opt = document.createElement('option');
      opt.value = r;
      opt.text = r.charAt(0).toUpperCase() + r.slice(1) + ' ' + roleIcon(r);
      if(r === 'member') opt.selected = true;
      select.appendChild(opt);
  });
  tdRoleSelect.appendChild(select);
  tr.appendChild(tdRoleSelect);

  // Role icon
  let tdRoleIcon = document.createElement('td');
  tdRoleIcon.className = 'role-icon';
  tdRoleIcon.textContent = roleIcon('member');
  tr.appendChild(tdRoleIcon);

  select.onchange = function() {
    tdRoleIcon.textContent = roleIcon(this.value);
  };

  // Name + info icon
  let tdName = document.createElement('td');
  tdName.contentEditable = editMode ? "true" : "false";

  let infoIcon = document.createElement('span');
  infoIcon.className = 'info-icon';
  infoIcon.textContent = '‚ÑπÔ∏è';
  infoIcon.title = 'Zobrazit / upravit info hr√°ƒçe';
  infoIcon.onclick = () => openInfoModal(tdInfo, tdName);
  tdName.appendChild(document.createTextNode(''));
  tdName.appendChild(infoIcon);
  tr.appendChild(tdName);

  // Level
  let tdLevel = document.createElement('td');
  tdLevel.contentEditable = editMode ? "true" : "false";
  tr.appendChild(tdLevel);

  // Workshop Level
  let tdWorkshop = document.createElement('td');
  tdWorkshop.contentEditable = editMode ? "true" : "false";
  tr.appendChild(tdWorkshop);

  // Workshop Status
  let tdWorkshopStatus = document.createElement('td');
  tdWorkshopStatus.className = 'workshop-status';
  tdWorkshopStatus.textContent = '-';
  tr.appendChild(tdWorkshopStatus);

  // Missed fights
  let tdMissed = document.createElement('td');
  tdMissed.contentEditable = editMode ? "true" : "false";
  tr.appendChild(tdMissed);

  // Info skryt√©
  let tdInfo = document.createElement('td');
  tdInfo.style.display = 'none';
  tr.appendChild(tdInfo);

  // Delete button
  let tdDelete = document.createElement('td');
  let btnDelete = document.createElement('button');
  btnDelete.textContent = 'Smazat';
  btnDelete.disabled = !editMode;
  btnDelete.className = 'delete-btn';
  btnDelete.onclick = () => {
    if(!editMode) return alert('Nejd≈ô√≠ve povol √∫pravy');
    if(confirm('Opravdu smazat tento ≈ô√°dek?')) {
      tr.remove();
    }
  };
  tdDelete.appendChild(btnDelete);
  tr.appendChild(tdDelete);
}


    } else if(tbodyId === 'xpBody' || tbodyId === 'heroconBody') {
      // Pro turnaje
      ['Rank','Name','Points'].forEach(() => {
        const td = document.createElement('td');
        td.contentEditable = "true";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
      return;
    }

    tbody.appendChild(tr);
  }

  // --- Update turnaj≈Ø (p≈ôepoƒç√≠tat workshop status u hr√°ƒç≈Ø v p≈ô√≠padƒõ pot≈ôeby) ---
  function updateTournament(type) {
    if(type === 'xp') {
      alert('Funkce aktualizace XP Tournament zat√≠m nen√≠ implementov√°na.');
      document.getElementById('xpUpdateDate').textContent = new Date().toLocaleString();
    } else if(type === 'herocon') {
      alert('Funkce aktualizace HeroCon Tournament zat√≠m nen√≠ implementov√°na.');
      document.getElementById('heroconUpdateDate').textContent = new Date().toLocaleString();
    }
  }

  // --- Grafy ---

  function createXPChart() {
    const ctx = document.getElementById('xpChart').getContext('2d');
    const names = [];
    const points = [];
    document.querySelectorAll('#xpBody tr').forEach(tr => {
      names.push(tr.cells[1].textContent);
      points.push(Number(tr.cells[2].textContent) || 0);
    });
    return new Chart(ctx, {
      type: 'bar',
      data: {
        labels: names,
        datasets: [{
          label: 'XP',
          data: points,
          backgroundColor: 'rgba(0,255,200,0.6)',
          borderColor: 'rgba(0,255,200,1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { labels: { color: '#00ffc8' } } }
      }
    });
  }

  function createHeroConChart() {
    const ctx = document.getElementById('heroconChart').getContext('2d');
    const names = [];
    const points = [];
    document.querySelectorAll('#heroconBody tr').forEach(tr => {
      names.push(tr.cells[1].textContent);
      points.push(Number(tr.cells[2].textContent) || 0);
    });
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: names,
        datasets: [{
          label: 'HeroCon',
          data: points,
          borderColor: '#00ffc8',
          backgroundColor: 'rgba(0,255,200,0.3)',
          fill: true,
          tension: 0.3,
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { labels: { color: '#00ffc8' } } }
      }
    });
  }

  let xpChart, heroconChart;

  function refreshCharts() {
    if(xpChart) xpChart.destroy();
    if(heroconChart) heroconChart.destroy();
    xpChart = createXPChart();
    heroconChart = createHeroConChart();
  }

  function openInfoModal(tdInfoCell, tdNameCell) {
    if (!editMode) return alert('Nejd≈ô√≠ve povol √∫pravy.');

    const modal = document.getElementById('infoModal');
    const overlay = document.getElementById('modalOverlay');
    const textarea = document.getElementById('infoText');

    textarea.value = tdInfoCell.textContent;

    modal.style.display = 'block';
    overlay.style.display = 'block';

    // ulo≈æ√≠me do mod√°ln√≠ho okna reference pro update
    modal.currentInfoCell = tdInfoCell;
    modal.currentNameCell = tdNameCell;
  }

  function closeModal(cancel = false) {
    const modal = document.getElementById('infoModal');
    const overlay = document.getElementById('modalOverlay');
    if (!cancel) {
      // ulo≈æit zmƒõny do skryt√©ho td info
      modal.currentInfoCell.textContent = document.getElementById('infoText').value;
    }
    modal.style.display = 'none';
    overlay.style.display = 'none';
  }

  
  // --- PDF export ---
  async function saveTableToPDF(tableId, title) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setTextColor('#00ffc8');
    doc.setFontSize(18);
    doc.text(title, 10, 15);

    const table = document.getElementById(tableId);
    const data = [];
    const headers = [];
    table.querySelectorAll('thead th').forEach(th => {
      headers.push(th.textContent);
    });
    table.querySelectorAll('tbody tr').forEach(tr => {
      const row = [];
      tr.querySelectorAll('td').forEach(td => {
        row.push(td.textContent);
      });
      data.push(row);
    });

    doc.setFontSize(11);
    doc.autoTable({
      head: [headers],
      body: data,
      startY: 25,
      theme: 'grid',
      headStyles: { fillColor: [0, 255, 200] },
      styles: { textColor: 0, fontSize: 9 }
    });

    doc.save(title + '.pdf');
  }

  // --- Initialization ---

  // Render players on page load
  renderPlayers();
  refreshCharts();

  // Recreate charts on table content change
  document.querySelectorAll('#xpBody, #heroconBody').forEach(tbody => {
    tbody.addEventListener('input', () => {
      refreshCharts();
    });
  });

</script>

  
  
<!-- Add jsPDF autotable plugin (needed for tables in PDF) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<!-- Modal pro info hr√°ƒçe -->
<div id="infoModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
  background:#2a2a3d; border:2px solid #00ffc8; padding:20px; border-radius:10px; z-index:1000; width:300px;">
  <h3>Info o hr√°ƒçi</h3>
  <textarea id="infoText" style="width:100%; height:120px; background:#1f1f2e; color:#00ffc8; border:none; resize:none;"></textarea>
  <div style="margin-top:10px; text-align:right;">
    <button onclick="closeModal()" style="background:#00ffc8; border:none; padding:5px 10px; cursor:pointer; border-radius:6px;">Ulo≈æit</button>
    <button onclick="closeModal(true)" style="background:#ff5050; border:none; padding:5px 10px; cursor:pointer; border-radius:6px; margin-left:5px;">Zru≈°it</button>
  </div>
</div>
<div id="modalOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5); z-index:999;"></div>
  
</body>
</html>
