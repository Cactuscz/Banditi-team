<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Banditi - Team Stats</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDlWV1eFKgh-B8_D_7bDQqf1PwgJEgMRaY",
    authDomain: "banditi.firebaseapp.com",
    projectId: "banditi",
    storageBucket: "banditi.firebasestorage.app",
    messagingSenderId: "319931947074",
    appId: "1:319931947074:web:1c2687024644b731caf5db",
    measurementId: "G-9NJQ6Q8XXY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.firebaseLoadData = async function () {
    const snap = await getDoc(doc(db, "banditi", "data"));
    if (snap.exists()) {
      const data = snap.data();
      window.playersData = data.playersData || [];
      window.xpDataStorage = data.xpData || [];
      window.heroconDataStorage = data.heroconData || [];
      window.guildInfoText = data.guildInfoText || "";
    } else {
      window.playersData = [];
      window.xpDataStorage = [];
      window.heroconDataStorage = [];
      window.guildInfoText = "";
    }
  }

  window.firebaseSaveAll = async function () {
    await setDoc(doc(db, "banditi", "data"), {
      playersData: window.playersData,
      xpData: window.xpDataStorage,
      heroconData: window.heroconDataStorage,
      guildInfoText: document.getElementById('guildInfoText')?.value || ""
    });
  }
</script>
</head>
<body>
<!-- zbytek HTML zůstává stejný až po skript -->
<script>
  const { jsPDF } = window.jspdf;
  let editMode = false;

  function savePlayersData() {
    firebaseSaveAll();
  }

  function saveTournamentData(tbodyId, dataArray) {
    if (tbodyId === 'xpBody') {
      window.xpDataStorage = dataArray;
    } else if (tbodyId === 'heroconBody') {
      window.heroconDataStorage = dataArray;
    }
    firebaseSaveAll();
  }

  function saveGuildInfo() {
    firebaseSaveAll();
    alert('Guild info uloženo.');
  }

  async function init() {
    await firebaseLoadData();
    renderPlayers();
    renderTournamentTable('xpBody', xpDataStorage);
    renderTournamentTable('heroconBody', heroconDataStorage);
    updateCharts();
    loadGuildInfo();
  }

  window.onload = init;
</script>
</body>
</html>
