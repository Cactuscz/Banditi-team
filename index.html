<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banditi - Guild Management Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --background: 222 17% 11%;
            --foreground: 210 40% 98%;
            --muted: 217 32% 17%;
            --muted-foreground: 215 20% 65%;
            --primary: 186 88% 44%;
            --primary-foreground: 222 17% 11%;
            --border: 217 32% 17%;
            --card: 222 17% 11%;
            --guild-400: 186 88% 44%;
        }
        
        body {
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        .glass-card {
            background: hsl(var(--card) / 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid hsl(var(--border) / 0.2);
        }
        
        .status-positive { color: hsl(142, 76%, 56%); font-weight: 600; }
        .status-negative { color: hsl(0, 84%, 60%); font-weight: 600; }
        .status-neutral { color: hsl(var(--guild-400)); font-weight: 600; }
        
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px hsl(var(--background) / 0.3);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .section { display: none; }
        .section.active { display: block; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: hsl(var(--muted)); }
        ::-webkit-scrollbar-thumb { background: hsl(var(--muted-foreground) / 0.3); border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAMuBW2ZZVja7lcf88cJuBmCXJzjp35Ur0",
            authDomain: "banditi-c15a8.firebaseapp.com",
            projectId: "banditi-c15a8",
            storageBucket: "banditi-c15a8.firebasestorage.app",
            messagingSenderId: "185952741494",
            appId: "1:185952741494:web:3069a101b847b661e91757",
            measurementId: "G-NK07GNCLJ4"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Workshop Calculator
        const workshopLimits = [
            { level: 500, maxWorkshop: 20 }, { level: 450, maxWorkshop: 19 },
            { level: 400, maxWorkshop: 18 }, { level: 350, maxWorkshop: 17 },
            { level: 325, maxWorkshop: 16 }, { level: 300, maxWorkshop: 15 },
            { level: 275, maxWorkshop: 14 }, { level: 250, maxWorkshop: 13 },
            { level: 230, maxWorkshop: 12 }, { level: 210, maxWorkshop: 11 },
            { level: 190, maxWorkshop: 10 }, { level: 170, maxWorkshop: 9 },
            { level: 150, maxWorkshop: 8 }, { level: 100, maxWorkshop: 7 }
        ];

        function calculateWorkshopStatus(level, workshop) {
            let allowedWorkshop = 7;
            for (const limit of workshopLimits) {
                if (level >= limit.level) {
                    allowedWorkshop = limit.maxWorkshop;
                    break;
                }
            }
            const difference = workshop - allowedWorkshop;
            if (difference > 0) return `+${difference}`;
            else if (difference < 0) return difference.toString();
            else return 'Optimal';
        }

        // Firebase Hook
        function useFirebaseData() {
            const [loading, setLoading] = useState(false);

            const loadPlayersData = useCallback(async () => {
                setLoading(true);
                try {
                    const docRef = db.collection('banditiData').doc('players');
                    const docSnap = await docRef.get();
                    if (docSnap.exists) {
                        return docSnap.data().list || [];
                    } else {
                        const defaultPlayers = [
                            { id: '1', name: 'Sazaro', level: 527, workshop: 20, missed: 0, info: 'Velitel t√Ωmu.', role: 'leader' },
                            { id: '2', name: 'Alfa', level: 521, workshop: 20, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' },
                            { id: '3', name: 'Liones', level: 515, workshop: 19, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' },
                            { id: '4', name: 'Bandita', level: 506, workshop: 20, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' },
                            { id: '5', name: 'Blesk', level: 500, workshop: 20, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' },
                            { id: '6', name: 'Ranny', level: 480, workshop: 19, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' },
                            { id: '7', name: 'Loniz1337', level: 475, workshop: 19, missed: 0, info: 'D≈Østojn√≠k.', role: 'officer' }
                        ];
                        await savePlayersData(defaultPlayers);
                        return defaultPlayers;
                    }
                } catch (error) {
                    console.error('Error loading players data:', error);
                    return [];
                } finally {
                    setLoading(false);
                }
            }, []);

            const savePlayersData = useCallback(async (players) => {
                try {
                    await db.collection('banditiData').doc('players').set({ list: players });
                } catch (error) {
                    console.error('Error saving players data:', error);
                    throw error;
                }
            }, []);

            const loadTournamentData = useCallback(async (type) => {
                setLoading(true);
                try {
                    const docRef = db.collection('banditiData').doc(type);
                    const docSnap = await docRef.get();
                    if (docSnap.exists) {
                        return docSnap.data().list || [];
                    } else {
                        const defaultData = [
                            { id: '1', rank: 1, name: 'Alfa', gained: type === 'xp' ? 1230 : 540 },
                            { id: '2', rank: 2, name: 'Sazaro', gained: type === 'xp' ? 980 : 480 },
                            { id: '3', rank: 3, name: 'Bandita', gained: type === 'xp' ? 840 : 300 }
                        ];
                        await saveTournamentData(type, defaultData);
                        return defaultData;
                    }
                } catch (error) {
                    console.error(`Error loading ${type} data:`, error);
                    return [];
                } finally {
                    setLoading(false);
                }
            }, []);

            const saveTournamentData = useCallback(async (type, data) => {
                try {
                    await db.collection('banditiData').doc(type).set({ list: data });
                } catch (error) {
                    console.error(`Error saving ${type} data:`, error);
                    throw error;
                }
            }, []);

            const loadGuildInfo = useCallback(async () => {
                setLoading(true);
                try {
                    const docRef = db.collection('banditiData').doc('guildinfo');
                    const docSnap = await docRef.get();
                    return docSnap.exists ? docSnap.data().text || '' : '';
                } catch (error) {
                    console.error('Error loading guild info:', error);
                    return '';
                } finally {
                    setLoading(false);
                }
            }, []);

            const saveGuildInfo = useCallback(async (text) => {
                try {
                    await db.collection('banditiData').doc('guildinfo').set({ text });
                } catch (error) {
                    console.error('Error saving guild info:', error);
                    throw error;
                }
            }, []);

            return {
                loading, loadPlayersData, savePlayersData,
                loadTournamentData, saveTournamentData,
                loadGuildInfo, saveGuildInfo
            };
        }

        // Navigation Component
        function Navigation({ currentSection, onSectionChange, editMode, onToggleEditMode }) {
            const navItems = [
                { id: 'guildinfo', label: 'Guild Info', icon: 'üè∞' },
                { id: 'players', label: 'Members', icon: 'üë•' },
                { id: 'xp', label: 'XP Tournament', icon: 'üìà' },
                { id: 'herocon', label: 'HeroCon', icon: '‚öîÔ∏è' }
            ];

            return (
                <header className="glass-card sticky top-0 z-50 border-b border-gray-700">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-4">
                                <div className="w-10 h-10 bg-gradient-to-br from-cyan-400 to-cyan-600 rounded-lg flex items-center justify-center font-bold text-gray-900">
                                    B
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold bg-gradient-to-r from-cyan-400 to-cyan-600 bg-clip-text text-transparent">
                                        Banditi Guild
                                    </h1>
                                    <p className="text-sm text-gray-400">Management Dashboard</p>
                                </div>
                            </div>
                            
                            <nav className="hidden md:flex space-x-1">
                                {navItems.map((item) => (
                                    <button
                                        key={item.id}
                                        onClick={() => onSectionChange(item.id)}
                                        className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                            currentSection === item.id 
                                                ? 'bg-cyan-600 text-gray-900' 
                                                : 'text-gray-300 hover:bg-gray-700'
                                        }`}
                                    >
                                        <span>{item.icon}</span>
                                        <span>{item.label}</span>
                                    </button>
                                ))}
                            </nav>
                            
                            <div className="flex items-center space-x-3">
                                <button
                                    onClick={onToggleEditMode}
                                    className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                        editMode 
                                            ? 'bg-cyan-600 text-gray-900' 
                                            : 'border border-gray-600 text-gray-300 hover:bg-gray-700'
                                    }`}
                                >
                                    <span>‚úèÔ∏è</span>
                                    <span className="hidden sm:inline">
                                        {editMode ? 'View Mode' : 'Edit Mode'}
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        }

        // Guild Info Component
        function GuildInfo() {
            const [guildInfoText, setGuildInfoText] = useState("");
            const { saveGuildInfo, loadGuildInfo, loading } = useFirebaseData();

            const guildStats = {
                memberCount: 47,
                activeCount: 42,
                avgLevel: 387,
                totalPower: 18239
            };

            useEffect(() => {
                loadGuildInfo().then(setGuildInfoText);
            }, [loadGuildInfo]);

            const handleSave = async () => {
                try {
                    await saveGuildInfo(guildInfoText);
                    alert('Guild info ulo≈æeno!');
                } catch (error) {
                    console.error('Error saving guild info:', error);
                    alert('Chyba p≈ôi ukl√°d√°n√≠!');
                }
            };

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-3xl font-bold text-cyan-400 mb-2">Guild Information</h2>
                        <p className="text-gray-400">Manage your guild's information and announcements</p>
                    </div>
                    
                    <div className="grid lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-1 space-y-6">
                            <div className="glass-card hover-lift rounded-xl p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-semibold text-cyan-400">Guild Stats</h3>
                                    <div className="w-8 h-8 bg-cyan-600 rounded-lg flex items-center justify-center">
                                        üéØ
                                    </div>
                                </div>
                                <div className="space-y-3">
                                    <div className="flex justify-between">
                                        <span className="text-gray-400">Total Members</span>
                                        <span className="font-semibold text-cyan-400">{guildStats.memberCount}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-400">Active Players</span>
                                        <span className="font-semibold text-green-400">{guildStats.activeCount}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-400">Average Level</span>
                                        <span className="font-semibold text-cyan-400">{guildStats.avgLevel}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-400">Guild Power</span>
                                        <span className="font-semibold text-cyan-400">{guildStats.totalPower.toLocaleString()}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="lg:col-span-2">
                            <div className="glass-card rounded-xl p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-semibold text-cyan-400">
                                        Guild Announcements & Info
                                    </h3>
                                    <button 
                                        onClick={handleSave} 
                                        disabled={loading}
                                        className="flex items-center space-x-2 px-4 py-2 bg-cyan-600 text-gray-900 rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50"
                                    >
                                        <span>üíæ</span>
                                        <span>Save Changes</span>
                                    </button>
                                </div>
                                <textarea
                                    value={guildInfoText}
                                    onChange={(e) => setGuildInfoText(e.target.value)}
                                    placeholder="Write guild announcements, rules, and important information here..."
                                    className="w-full h-96 bg-gray-800 border border-gray-600 rounded-lg p-4 text-gray-200 resize-y focus:outline-none focus:ring-2 focus:ring-cyan-400"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Players Component
        function Players() {
            const [players, setPlayers] = useState([]);
            const [filteredPlayers, setFilteredPlayers] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [roleFilter, setRoleFilter] = useState("all");
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            
            const { loadPlayersData, savePlayersData, loading } = useFirebaseData();

            useEffect(() => {
                loadPlayersData().then(setPlayers);
            }, [loadPlayersData]);

            useEffect(() => {
                let filtered = players;
                if (searchTerm) {
                    filtered = filtered.filter(player => 
                        player.name.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }
                if (roleFilter && roleFilter !== 'all') {
                    filtered = filtered.filter(player => player.role === roleFilter);
                }
                setFilteredPlayers(filtered);
            }, [players, searchTerm, roleFilter]);

            const getRoleIcon = (role) => {
                switch (role) {
                    case 'leader': return 'üëë';
                    case 'officer': return 'üõ°Ô∏è';
                    default: return 'üë§';
                }
            };

            const getStatusClass = (status) => {
                if (status.includes('+')) return 'status-positive';
                if (status.includes('-')) return 'status-negative';
                return 'status-neutral';
            };

            const handleFieldUpdate = async (playerId, field, value) => {
                const updatedPlayers = players.map(player =>
                    player.id === playerId ? { ...player, [field]: value } : player
                );
                setPlayers(updatedPlayers);
                await savePlayersData(updatedPlayers);
            };

            const handleAddPlayer = async () => {
                const newPlayer = {
                    id: `player_${Date.now()}`,
                    name: 'New Player',
                    level: 0,
                    workshop: 0,
                    missed: 0,
                    info: '',
                    role: 'member'
                };
                const updatedPlayers = [...players, newPlayer];
                setPlayers(updatedPlayers);
                await savePlayersData(updatedPlayers);
            };

            const handleDeletePlayer = async (playerId) => {
                if (confirm('Are you sure you want to remove this player?')) {
                    const updatedPlayers = players.filter(player => player.id !== playerId);
                    setPlayers(updatedPlayers);
                    await savePlayersData(updatedPlayers);
                }
            };

            const handlePlayerInfo = (player) => {
                setSelectedPlayer(player);
                setModalOpen(true);
            };

            const handleSavePlayerInfo = async (playerId, info) => {
                const updatedPlayers = players.map(player =>
                    player.id === playerId ? { ...player, info } : player
                );
                setPlayers(updatedPlayers);
                await savePlayersData(updatedPlayers);
                setModalOpen(false);
            };

            return (
                <div className="animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-3xl font-bold text-cyan-400 mb-2">Guild Members</h2>
                        <p className="text-gray-400">Manage member roles, levels, and workshop status</p>
                    </div>
                    
                    {/* Search and Filters */}
                    <div className="glass-card rounded-xl p-6 mb-6">
                        <div className="grid md:grid-cols-3 gap-4">
                            <div className="relative">
                                <span className="absolute left-3 top-3 text-gray-400">üîç</span>
                                <input
                                    type="text"
                                    placeholder="Search by name..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                                />
                            </div>
                            <select
                                value={roleFilter}
                                onChange={(e) => setRoleFilter(e.target.value)}
                                className="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                            >
                                <option value="all">All Roles</option>
                                <option value="leader">Leader</option>
                                <option value="officer">Officer</option>
                                <option value="member">Member</option>
                            </select>
                            <button
                                onClick={handleAddPlayer}
                                className="flex items-center justify-center space-x-2 px-4 py-2 bg-cyan-600 text-gray-900 rounded-lg hover:bg-cyan-700 transition-colors"
                            >
                                <span>‚ûï</span>
                                <span>Add Member</span>
                            </button>
                        </div>
                    </div>
                    
                    {/* Members Table */}
                    <div className="glass-card rounded-xl overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="bg-gray-800 border-b border-gray-700">
                                        <th className="px-6 py-4 text-left text-cyan-400 font-semibold">Role</th>
                                        <th className="px-6 py-4 text-left text-cyan-400 font-semibold">Member</th>
                                        <th className="px-6 py-4 text-center text-cyan-400 font-semibold">Level</th>
                                        <th className="px-6 py-4 text-center text-cyan-400 font-semibold">Workshop</th>
                                        <th className="px-6 py-4 text-center text-cyan-400 font-semibold">Status</th>
                                        <th className="px-6 py-4 text-center text-cyan-400 font-semibold">Missed</th>
                                        <th className="px-6 py-4 text-center text-cyan-400 font-semibold">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredPlayers.map((player) => {
                                        const status = calculateWorkshopStatus(player.level, player.workshop);
                                        return (
                                            <tr key={player.id} className="border-b border-gray-700 hover:bg-gray-800">
                                                <td className="px-6 py-4">
                                                    <div className="flex items-center space-x-2">
                                                        <span className="text-2xl">{getRoleIcon(player.role)}</span>
                                                        <select
                                                            value={player.role}
                                                            onChange={(e) => handleFieldUpdate(player.id, 'role', e.target.value)}
                                                            className="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-cyan-400"
                                                        >
                                                            <option value="leader">Leader</option>
                                                            <option value="officer">Officer</option>
                                                            <option value="member">Member</option>
                                                        </select>
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <div className="flex items-center space-x-3">
                                                        <div className="w-8 h-8 bg-gradient-to-br from-cyan-400 to-cyan-600 rounded-full flex items-center justify-center text-gray-900 font-bold text-sm">
                                                            {player.name.charAt(0).toUpperCase()}
                                                        </div>
                                                        <input
                                                            value={player.name}
                                                            onChange={(e) => handleFieldUpdate(player.id, 'name', e.target.value)}
                                                            className="bg-transparent border-0 p-0 text-gray-200 font-semibold focus:outline-none"
                                                        />
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <span className="inline-block px-3 py-1 bg-cyan-900 text-cyan-300 rounded-full text-sm font-semibold">
                                                        <input
                                                            type="number"
                                                            value={player.level}
                                                            onChange={(e) => handleFieldUpdate(player.id, 'level', parseInt(e.target.value) || 0)}
                                                            className="w-12 bg-transparent text-center border-0 p-0 focus:outline-none"
                                                        />
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <input
                                                        type="number"
                                                        value={player.workshop}
                                                        onChange={(e) => handleFieldUpdate(player.id, 'workshop', parseInt(e.target.value) || 0)}
                                                        className="w-16 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-center text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                                                    />
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <span className={`font-semibold ${getStatusClass(status)}`}>
                                                        {status}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <input
                                                        type="number"
                                                        value={player.missed}
                                                        onChange={(e) => handleFieldUpdate(player.id, 'missed', parseInt(e.target.value) || 0)}
                                                        className="w-16 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-center text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                                                    />
                                                </td>
                                                <td className="px-6 py-4 text-center">
                                                    <div className="flex items-center justify-center space-x-2">
                                                        <button
                                                            onClick={() => handlePlayerInfo(player)}
                                                            className="p-2 text-cyan-400 hover:bg-gray-700 rounded transition-colors"
                                                        >
                                                            ‚ÑπÔ∏è
                                                        </button>
                                                        <button
                                                            onClick={() => handleDeletePlayer(player.id)}
                                                            className="p-2 text-red-400 hover:bg-gray-700 rounded transition-colors"
                                                        >
                                                            üóëÔ∏è
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Workshop Guidelines */}
                    <div className="glass-card rounded-xl p-6 mt-8">
                        <h3 className="text-lg font-semibold text-cyan-400 mb-4">Workshop Level Guidelines</h3>
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                            {workshopLimits.map((limit) => (
                                <div key={limit.level} className="bg-gray-800 rounded-lg p-3 text-center">
                                    <div className="text-sm text-gray-400">Level {limit.level}+</div>
                                    <div className="text-lg font-semibold text-cyan-400">
                                        Workshop {limit.maxWorkshop}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Player Info Modal */}
                    {modalOpen && selectedPlayer && (
                        <div className="fixed inset-0 bg-black bg-opacity
