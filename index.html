<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Banditi - Team Stats</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDlWV1eFKgh-B8_D_7bDQqf1PwgJEgMRaY",
    authDomain: "banditi.firebaseapp.com",
    projectId: "banditi",
    storageBucket: "banditi.firebasestorage.app",
    messagingSenderId: "319931947074",
    appId: "1:319931947074:web:1c2687024644b731caf5db",
    measurementId: "G-9NJQ6Q8XXY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.firebaseLoadData = async function () {
    const snap = await getDoc(doc(db, "banditi", "data"));
    if (snap.exists()) {
      const data = snap.data();
      window.playersData = data.playersData || [];
      window.xpDataStorage = data.xpData || [];
      window.heroconDataStorage = data.heroconData || [];
      window.guildInfoText = data.guildInfoText || "";
    } else {
      window.playersData = [];
      window.xpDataStorage = [];
      window.heroconDataStorage = [];
      window.guildInfoText = "";
    }
  }

  window.firebaseSaveAll = async function () {
    await setDoc(doc(db, "banditi", "data"), {
      playersData: window.playersData,
      xpData: window.xpDataStorage,
      heroconData: window.heroconDataStorage,
      guildInfoText: document.getElementById('guildInfoText')?.value || ""
    });
  }
</script>
</head>
<body>

<h1>Banditi - Team Stats</h1>

<h2>Guild Info</h2>
<textarea id="guildInfoText" rows="5" cols="50"></textarea>
<button onclick="saveGuildInfo()">Ulo≈æit Guild Info</button>

<h2>Players</h2>
<table border="1" id="playersTable">
  <thead>
    <tr>
      <th>Jm√©no</th>
      <th>Level</th>
      <th>D√≠lna</th>
      <th>Role</th>
      <th>Info</th>
    </tr>
  </thead>
  <tbody id="playersBody"></tbody>
</table>

<h2>XP Tournament</h2>
<table border="1" id="xpTable">
  <thead>
    <tr><th>Po≈ôad√≠</th><th>Jm√©no</th><th>Z√≠sk√°no XP</th></tr>
  </thead>
  <tbody id="xpBody"></tbody>
</table>

<h2>HeroCon Tournament</h2>
<table border="1" id="heroconTable">
  <thead>
    <tr><th>Po≈ôad√≠</th><th>Jm√©no</th><th>Z√≠sk√°no XP</th></tr>
  </thead>
  <tbody id="heroconBody"></tbody>
</table>

<script>
  const { jsPDF } = window.jspdf;
  let editMode = false;

  // Role ikony
  function roleIcon(role) {
    switch(role) {
      case 'leader': return 'üëë';
      case 'officer': return 'üõ°Ô∏è';
      default: return 'üë§';
    }
  }

  // Render hr√°ƒç≈Ø do tabulky
  function renderPlayers() {
    const tbody = document.getElementById('playersBody');
    tbody.innerHTML = '';
    for (const p of window.playersData) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.name} ${roleIcon(p.role)}</td>
        <td>${p.level}</td>
        <td>${p.workshop}</td>
        <td>${p.role}</td>
        <td>${p.info}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  // Render turnajov√Ωch dat
  function renderTournamentTable(tbodyId, dataArray) {
    const tbody = document.getElementById(tbodyId);
    tbody.innerHTML = '';
    for (const item of dataArray) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.rank}</td>
        <td>${item.name}</td>
        <td>${item.gained}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  // Zat√≠m pr√°zdn√° funkce pro grafy (pokud chce≈°)
  function updateCharts() {
    // TODO: p≈ôidat vykreslen√≠ graf≈Ø
  }

  // Naƒç√≠st guild info do textarea
  function loadGuildInfo() {
    document.getElementById('guildInfoText').value = window.guildInfoText || '';
  }

  function savePlayersData() {
    firebaseSaveAll();
  }

  function saveTournamentData(tbodyId, dataArray) {
    if (tbodyId === 'xpBody') {
      window.xpDataStorage = dataArray;
    } else if (tbodyId === 'heroconBody') {
      window.heroconDataStorage = dataArray;
    }
    firebaseSaveAll();
  }

  function saveGuildInfo() {
    firebaseSaveAll();
    alert('Guild info ulo≈æeno.');
  }

  async function init() {
    await firebaseLoadData();
    renderPlayers();
    renderTournamentTable('xpBody', window.xpDataStorage);
    renderTournamentTable('heroconBody', window.heroconDataStorage);
    updateCharts();
    loadGuildInfo();
  }

  window.onload = init;

</script>

</body>
</html>
